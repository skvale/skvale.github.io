<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and undefined."/><meta property="og:image"/><title>I increased the speed of my requests by 1000x</title><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/6b22687a8822c670b02e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6b22687a8822c670b02e.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6f4272a048091359c753.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6f4272a048091359c753.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-92300432a1172ef1338b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-899697ea82bdc85e7a94.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-752bd3b6185152c691e4.js" as="script"/><link rel="preload" href="/_next/static/chunks/545f34e4-5ab7a5c3cfda248e77bf.js" as="script"/><link rel="preload" href="/_next/static/chunks/b98bc7c3-35ab3a22cb01e60c1bf9.js" as="script"/><link rel="preload" href="/_next/static/chunks/298-2505fec15115db16e42f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-ca6ea9f5615be40e9180.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">skvale</a></h2><article class="mb-32"><div class="max-w-2xl mx-auto"><h1 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">I increased the speed of my requests by 1000x</h1><div class="mb-6 text-lg"><time class="text-sm" dateTime="2021-05-21T05:35:07.322Z">May	21, 2021</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>I should clarify that this is all from the perspective of local development.</p>
<h2>I'm primarily a frontend engineer</h2>
<p>In my new job, requests to a development server were taking about 12 - 20 seconds. Originally I noticed that 90% of the requests were the same response so I decided to return mocked data.</p>
<h2>MSW success</h2>
<p>Using mock-service-worker worked well. I saw requests to mocks coming back in 20ms, but it opened up a lot more ideas as well. I could switch any data I want from my APIs. I could see what any error conditions looked like. I could reproduce a bug from a race condition of response order. I could develop against responses that weren't finished in the backend yet.</p>
<p>This seemed like a great idea to build out further because it could make other engineers more efficient and enjoy their jobs more.</p>
<h2>Make it less complex</h2>
<p>We need to cut out unnecessary complexity in development environments. Not in a sense that it's a nice thing to do, but that software systems struggle to grow without removing complexity where it doesn't belong.</p>
<p>I removed other external dependencies in local development. Now I have an http-server serving an HTMLWebpackPlugin generated file which includes the JavaScript, CSS, and fonts.</p>
<p>I can work without WiFi, which is saying a lot when before there was an orchestration of Docker containers and Ruby apps.</p>
<p>When I want to do UI development, I can focus on the generated JavaScript/CSS bundles communicating via API requests. I can modify the JavaScript to behave differently given certain responses.</p>
<p>If I still want the broader integration, it isn't far away, but the simplicity of JS talking to a controlled API at lightning speed is a delightful experience.</p>
<h2>Is the mocked data valid</h2>
<p>Pretty soon I had a lot of JSON locally. For the majority of my use cases I want a snapshot of "real" data, so I created a script to generate the mocks from a web archive (<code>.har</code>) file. The generated mocks are disposable so they don't need to be kept up to date.</p>
<p>I also created bare bones mocks and utility functions to modify the mocked data. Changes in the API can happen within 1 function instead of many instances of mocks.</p>
<p>If you're using GraphQL the mocks can be made to match types generated from the schema. If you're using REST endpoints you could validate against OpenAPI schemas, if they exist.</p>
<h2>Modify it anywhere</h2>
<p>To increase visibility and ease of access I extended mock-service-worker to store the mocks as a global object, say <code>window.MOCKS</code>. Requests come into mock-service-worker and it looks at the global object to see if it has a request to respond with. The mocked requests and available utils are available like</p>
<pre><code class="language-js">window.MOCKS = {
  GET: {
    '/your/endpoint': {json: {}, delay: 0, status: 200},
    ...
  },
  POST: {},
  ...,
  utils: { modifyEndpoint: fn, ... }
}
</code></pre>
<p>This allows consumers to modify the global object any time before a request is made. Customizations could happen in a script tag in the HTML.</p>
<p>I've also used query parameters to toggle common things, like feature flags, permissions, configuration modes, and base mocks. It's a pleasant experience to modify the URL and refresh to see changes.</p>
<p>Some caveats: The path can be dynamic with path params and the response can be function of the request, context, and path params.</p>
<h2>Fast, predictable browser tests</h2>
<p>The same tool can be used for automated browser tests (Cypress, Puppeteer, etc). Tests have many possible states that are stored in the test files as calls to utility functions. We're able to copy-paste the modifications, or parts of them, into our development sandboxes and create new features.</p>
<h2>Make it easy to use</h2>
<p>The most difficult thing has been encouraging people to use it and see its value. As a new engineer on a team, I'm sensitive to shaking up the way things have been done. The ergonomics of use needed to be seamless and simple. There are 2 npm scripts. One to compile the JS and generate the dev HTML and another to start an http-server.</p>
<h2>Backend paradigm shift</h2>
<p>As with most decisions, there are unintended cultural consequences. This strategy has created more distance between UI engineers from the backend.</p>
<p>In development we're typically finding issues with the API and helping track down which configuration caused it. When the API is mocked, the backend isn't touched and these issues aren't found.</p>
<p>The attention shifts from looking at the backend as an extension of the UI to a service that responds to HTTP requests. This is a more appropriate boundary as apps grow, but may not be seen favorably on a smaller project.</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1" viewBox="0 0 48 48" enable-background="new 0 0 48 48" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><g fill="#263238"><path d="M11,44H9c-0.6,0-1-0.4-1-1v-2h4v2C12,43.6,11.6,44,11,44z"></path><path d="M39,44h-2c-0.6,0-1-0.4-1-1v-2h4v2C40,43.6,39.6,44,39,44z"></path></g><path fill="#37474F" d="M27,7h-6c-1.7,0-3,1.3-3,3v3h2v-3c0-0.6,0.4-1,1-1h6c0.6,0,1,0.4,1,1v3h2v-3C30,8.3,28.7,7,27,7z"></path><path fill="#78909C" d="M40,43H8c-2.2,0-4-1.8-4-4V15c0-2.2,1.8-4,4-4h32c2.2,0,4,1.8,4,4v24C44,41.2,42.2,43,40,43z"></path></svg></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M324.344 67.25c-44.475 19.314-91.03 25.953-136.656 1.938v39.53c45.86 22.493 90.487 21.026 136.656-.28V67.25zM133.72 74.22c-6.81.035-13.448.378-19.876 1-3.125 24.06 6.117 52.095 24.625 73.78 7.23-4.935 13.748-10.28 19.53-15.72-6.15-19.57-10.293-38.917-11.625-58.718-2.14-.095-4.324-.27-6.438-.312-2.082-.04-4.165-.042-6.218-.03zm245.343 0c-2.054-.012-4.136-.01-6.22.03-2.107.042-4.27.218-6.406.313-1.33 19.8-5.475 39.148-11.625 58.718 5.783 5.44 12.3 10.785 19.532 15.72 18.507-21.685 27.75-49.72 24.625-73.78-6.442-.624-13.086-.965-19.908-1zM94.75 78.062c-13.698 2.862-26.024 7.367-36.406 13.593-.193 29.268 13.016 59.952 33.156 77.22l-1.22 1.405c11.587-2.66 22.214-6.694 31.876-11.624-19.18-23.47-29.492-52.762-27.406-80.594zm323.313 0c2.086 27.83-8.227 57.123-27.407 80.593 9.663 4.93 20.29 8.964 31.875 11.625l-1.217-1.405c20.146-17.273 33.33-47.973 33.125-77.25-10.376-6.215-22.686-10.704-36.375-13.563zm-377.657 28c-13.318 14.436-20.88 34.407-20.53 62.406 17.887 4.688 34.462 6.026 49.686 4.936-16.07-18.11-26.396-42.29-29.156-67.344zm432 0c-2.76 25.052-13.084 49.234-29.156 67.343 15.225 1.09 31.8-.248 49.688-4.937.35-28-7.214-47.97-20.532-62.407zm-133.72 16.406l-.873.436c-24.024 11.837-48.424 18.767-72.907 20.28v214.095c73.59-26.01 122.813-81.045 122.813-144.25 0-13.11-2.14-25.886-6.158-38.155-17.663-9.017-32.466-20.5-44-32.063l-4.093-4.093 1.842-5.47c1.205-3.623 2.32-7.217 3.375-10.78zm-164.436.436c1.018 3.422 2.094 6.87 3.25 10.344l1.813 5.47-4.063 4.093c-12.424 12.456-28.62 24.84-48.125 34.125-3.644 11.637-5.563 23.723-5.563 36.093 0 63.404 50.45 118.71 124.657 144.595V143.28c-24.095-1.254-48.185-7.88-71.97-20.374zM157 326.72c-5.933 4.816-11.396 9.827-16.5 15 22.033 17.485 50.57 35.567 79.5 43.374 5.045-5.72 10.61-11.164 16.78-16.313L157 326.72zm197.906 0l-79.78 42.06c6.348 5.3 12.058 10.913 17.218 16.814 29.006-7.38 57.734-25.302 80.062-42.844-5.387-5.534-11.177-10.898-17.5-16.03zm-226.97 28.905c-6.25 7.537-11.945 15.36-17.25 23.375 23.228 18.444 53.698 37.554 84.25 44.594 3.68-7.79 7.9-15.355 12.783-22.594-30.46-9.71-58.2-28.08-79.782-45.375zm256.97 1.094c-21.83 17.33-49.757 35.53-80.312 44.874 4.804 7.193 8.967 14.706 12.594 22.437 30.588-6.498 61.223-25.386 84.78-43.874-5.26-8.024-10.874-15.883-17.062-23.437zM100.72 394.936c-5.853 9.823-11.394 19.87-16.97 30.032 28.236 27.185 59.256 42.295 95.28 45.78 2.33-10.074 5.165-19.994 8.657-29.656-33.072-8.298-63.446-27.63-86.968-46.156zm311.186 1.22c-23.8 18.54-54.345 37.583-87.5 45.406 3.415 9.513 6.18 19.277 8.47 29.187 36.024-3.485 67.044-18.595 95.28-45.78-5.346-9.746-10.664-19.378-16.25-28.814z"></path></svg></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"I increased the speed of my requests by 1000x","date":"2021-05-21T05:35:07.322Z","slug":"mocking-for-development","content":"\u003cp\u003eI should clarify that this is all from the perspective of local development.\u003c/p\u003e\n\u003ch2\u003eI'm primarily a frontend engineer\u003c/h2\u003e\n\u003cp\u003eIn my new job, requests to a development server were taking about 12 - 20 seconds. Originally I noticed that 90% of the requests were the same response so I decided to return mocked data.\u003c/p\u003e\n\u003ch2\u003eMSW success\u003c/h2\u003e\n\u003cp\u003eUsing mock-service-worker worked well. I saw requests to mocks coming back in 20ms, but it opened up a lot more ideas as well. I could switch any data I want from my APIs. I could see what any error conditions looked like. I could reproduce a bug from a race condition of response order. I could develop against responses that weren't finished in the backend yet.\u003c/p\u003e\n\u003cp\u003eThis seemed like a great idea to build out further because it could make other engineers more efficient and enjoy their jobs more.\u003c/p\u003e\n\u003ch2\u003eMake it less complex\u003c/h2\u003e\n\u003cp\u003eWe need to cut out unnecessary complexity in development environments. Not in a sense that it's a nice thing to do, but that software systems struggle to grow without removing complexity where it doesn't belong.\u003c/p\u003e\n\u003cp\u003eI removed other external dependencies in local development. Now I have an http-server serving an HTMLWebpackPlugin generated file which includes the JavaScript, CSS, and fonts.\u003c/p\u003e\n\u003cp\u003eI can work without WiFi, which is saying a lot when before there was an orchestration of Docker containers and Ruby apps.\u003c/p\u003e\n\u003cp\u003eWhen I want to do UI development, I can focus on the generated JavaScript/CSS bundles communicating via API requests. I can modify the JavaScript to behave differently given certain responses.\u003c/p\u003e\n\u003cp\u003eIf I still want the broader integration, it isn't far away, but the simplicity of JS talking to a controlled API at lightning speed is a delightful experience.\u003c/p\u003e\n\u003ch2\u003eIs the mocked data valid\u003c/h2\u003e\n\u003cp\u003ePretty soon I had a lot of JSON locally. For the majority of my use cases I want a snapshot of \"real\" data, so I created a script to generate the mocks from a web archive (\u003ccode\u003e.har\u003c/code\u003e) file. The generated mocks are disposable so they don't need to be kept up to date.\u003c/p\u003e\n\u003cp\u003eI also created bare bones mocks and utility functions to modify the mocked data. Changes in the API can happen within 1 function instead of many instances of mocks.\u003c/p\u003e\n\u003cp\u003eIf you're using GraphQL the mocks can be made to match types generated from the schema. If you're using REST endpoints you could validate against OpenAPI schemas, if they exist.\u003c/p\u003e\n\u003ch2\u003eModify it anywhere\u003c/h2\u003e\n\u003cp\u003eTo increase visibility and ease of access I extended mock-service-worker to store the mocks as a global object, say \u003ccode\u003ewindow.MOCKS\u003c/code\u003e. Requests come into mock-service-worker and it looks at the global object to see if it has a request to respond with. The mocked requests and available utils are available like\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ewindow.MOCKS = {\n  GET: {\n    '/your/endpoint': {json: {}, delay: 0, status: 200},\n    ...\n  },\n  POST: {},\n  ...,\n  utils: { modifyEndpoint: fn, ... }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis allows consumers to modify the global object any time before a request is made. Customizations could happen in a script tag in the HTML.\u003c/p\u003e\n\u003cp\u003eI've also used query parameters to toggle common things, like feature flags, permissions, configuration modes, and base mocks. It's a pleasant experience to modify the URL and refresh to see changes.\u003c/p\u003e\n\u003cp\u003eSome caveats: The path can be dynamic with path params and the response can be function of the request, context, and path params.\u003c/p\u003e\n\u003ch2\u003eFast, predictable browser tests\u003c/h2\u003e\n\u003cp\u003eThe same tool can be used for automated browser tests (Cypress, Puppeteer, etc). Tests have many possible states that are stored in the test files as calls to utility functions. We're able to copy-paste the modifications, or parts of them, into our development sandboxes and create new features.\u003c/p\u003e\n\u003ch2\u003eMake it easy to use\u003c/h2\u003e\n\u003cp\u003eThe most difficult thing has been encouraging people to use it and see its value. As a new engineer on a team, I'm sensitive to shaking up the way things have been done. The ergonomics of use needed to be seamless and simple. There are 2 npm scripts. One to compile the JS and generate the dev HTML and another to start an http-server.\u003c/p\u003e\n\u003ch2\u003eBackend paradigm shift\u003c/h2\u003e\n\u003cp\u003eAs with most decisions, there are unintended cultural consequences. This strategy has created more distance between UI engineers from the backend.\u003c/p\u003e\n\u003cp\u003eIn development we're typically finding issues with the API and helping track down which configuration caused it. When the API is mocked, the backend isn't touched and these issues aren't found.\u003c/p\u003e\n\u003cp\u003eThe attention shifts from looking at the backend as an extension of the UI to a service that responds to HTTP requests. This is a more appropriate boundary as apps grow, but may not be seen favorably on a smaller project.\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"mocking-for-development"},"buildId":"kQCV6N4YCX23whgU8A95Z","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" async=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" async=""></script><script src="/_next/static/chunks/main-899697ea82bdc85e7a94.js" async=""></script><script src="/_next/static/chunks/pages/_app-752bd3b6185152c691e4.js" async=""></script><script src="/_next/static/chunks/545f34e4-5ab7a5c3cfda248e77bf.js" async=""></script><script src="/_next/static/chunks/b98bc7c3-35ab3a22cb01e60c1bf9.js" async=""></script><script src="/_next/static/chunks/298-2505fec15115db16e42f.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-ca6ea9f5615be40e9180.js" async=""></script><script src="/_next/static/kQCV6N4YCX23whgU8A95Z/_buildManifest.js" async=""></script><script src="/_next/static/kQCV6N4YCX23whgU8A95Z/_ssgManifest.js" async=""></script></body></html>